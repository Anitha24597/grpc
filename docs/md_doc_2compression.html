<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GRPC C++: gRPC Compression</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GRPC C++<span id="projectnumber">&#160;1.72.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">gRPC Compression</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md54"></a> The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>.</p>
<h2><a class="anchor" id="autotoc_md55"></a>
Intent</h2>
<p>Compression is used to reduce the amount of bandwidth used between peers. The compression supported by gRPC acts <em>at the individual message level</em>, taking <em>message</em> <a class="el" href="md_doc_2_p_r_o_t_o_c_o_l-_h_t_t_p2.html">as defined in the wire format</a>document".

The implementation supports different compression algorithms. A &lt;em&gt;default
compression level&lt;/em&gt;, to be used in the absence of message-specific settings, MAY
be specified for during channel creation.

The ability to control compression settings per call and to enable/disable
compression on a per message basis MAY be used to prevent CRIME/BEAST attacks.
It also allows for asymmetric compression communication, whereby a response MAY
be compressed differently, if at all.

@subsection autotoc_md56 Specification

Compression MAY be configured by the Client Application by calling the
appropriate API method. There are two scenarios where compression MAY be
configured:

+  At channel creation time, which sets the channel default compression and
   therefore the compression that SHALL be used in the absence of per-RPC
   compression configuration.
+  At response time, via:
   +  For unary RPCs, the {Client,Server}Context instance.
   +  For streaming RPCs, the {Client,Server}Writer instance. In this case,
      configuration is reduced to disabling compression altogether.

@subsection autotoc_md57 Compression Method Asymmetry Between Peers

A gRPC peer MAY choose to respond using a different compression method to that
of the request, including not performing any compression, regardless of channel
and RPC settings (for example, if compression would result in small or negative
gains).

If a client message is compressed by an algorithm that is not supported
by a server, the message WILL result in an &lt;tt&gt;UNIMPLEMENTED&lt;/tt&gt; error status on the
server. The server will then include a &lt;tt&gt;grpc-accept-encoding&lt;/tt&gt; response
header which specifies the algorithms that the server accepts. If the client
message is compressed using one of the algorithms from the &lt;tt&gt;grpc-accept-encoding&lt;/tt&gt; header
and an &lt;tt&gt;UNIMPLEMENTED&lt;/tt&gt; error status is returned from the server, the cause of the error
MUST NOT be related to compression. If a server sent data which is compressed by an algorithm
that is not supported by the client, an &lt;tt&gt;INTERNAL&lt;/tt&gt; error status will occur on the client side.

Note that a peer MAY choose to not disclose all the encodings it supports.
However, if it receives a message compressed in an undisclosed but supported
encoding, it MUST include said encoding in the response's &lt;tt&gt;grpc-accept-encoding&lt;/tt&gt;
header.

For every message a server is requested to compress using an algorithm it knows
the client doesn't support (as indicated by the last &lt;tt&gt;grpc-accept-encoding&lt;/tt&gt;
header received from the client), it SHALL send the message uncompressed.

@subsection autotoc_md58 Specific Disabling of Compression

If the user (through the previously described mechanisms) requests to disable
compression the next message MUST be sent uncompressed. This is instrumental in
preventing BEAST/CRIME attacks. This applies to both the unary and streaming
cases.

@subsection autotoc_md59 Compression Levels and Algorithms

The set of supported algorithm is implementation dependent. In order to simplify
the public API and to operate seamlessly across implementations (both in terms
of languages but also different version of the same one), we introduce the idea
of &lt;em&gt;compression levels&lt;/em&gt; (such as "low", "medium", "high").

Levels map to concrete algorithms and/or their settings (such as "low" mapping
to "gzip -3" and "high" mapping to "gzip -9") automatically depending on what a
peer is known to support. A server is always aware of what its clients support,
as clients disclose it in the Message-Accept-Encoding header as part of the
RPC. A client doesn't a priori (presently) know which algorithms a
server supports. This issue can be addressed with an initial negotiation of
capabilities or an automatic retry mechanism. These features will be implemented
in the future. Currently however, compression levels are only supported at the
server side, which is aware of the client's capabilities through the incoming
Message-Accept-Encoding header.

@subsection autotoc_md60 Propagation to child RPCs

The inheritance of the compression configuration by child RPCs is left up to the
implementation. Note that in the absence of changes to the parent channel, its
configuration will be used.

@subsection autotoc_md61 Deflate Compression

Like HTTP implementations, gRPC implementations MUST use the "deflate"
compression to mean the zlib structure (defined in 
&lt;a href="<a href="https://datatracker.ietf.org/doc/html/rfc1950">https://datatracker.ietf.org/doc/html/rfc1950</a>" &gt;RFC 1950&lt;/a&gt;)
with the deflate compression algorithm (defined in 
&lt;a href="<a href="https://datatracker.ietf.org/doc/html/rfc1951">https://datatracker.ietf.org/doc/html/rfc1951</a>" &gt;RFC 1951&lt;/a&gt;).
Servers and clients MUST NOT send raw deflate data.

@subsection autotoc_md62 Test cases

1. When a compression level is not specified for either the channel or the
message, the default channel level &lt;em&gt;none&lt;/em&gt; is considered: data MUST NOT be
compressed.
1. When per-RPC compression configuration isn't present for a message, the
channel compression configuration MUST be used.
1. When a compression method (including no compression) is specified for an
outgoing message, the message MUST be compressed accordingly.
1. A message compressed by a client in a way not supported by its server MUST
fail with status &lt;tt&gt;UNIMPLEMENTED&lt;/tt&gt;, its associated description indicating the
unsupported condition as well as the supported ones. The returned
&lt;tt&gt;grpc-accept-encoding&lt;/tt&gt; header MUST NOT contain the compression method
(encoding) used.
1. A message compressed by a server in a way not supported by its client MUST
fail with status &lt;tt&gt;INTERNAL&lt;/tt&gt;, its associated description indicating the
unsupported condition as well as the supported ones. The returned
&lt;tt&gt;grpc-accept-encoding&lt;/tt&gt; header MUST NOT contain the compression method
(encoding) used.
1. An ill-constructed message with its &lt;a href="<a class="el" href="_p_r_o_t_o_c_o_l-_h_t_t_p2_8md.html">PROTOCOL-HTTP2.md</a>#compressed-flag"
 &gt;Compressed-Flag bit&lt;/a&gt;
set but lacking a
&lt;a href="<a class="el" href="_p_r_o_t_o_c_o_l-_h_t_t_p2_8md.html">PROTOCOL-HTTP2.md</a>#message-encoding" &gt;grpc-encoding entry different from <em>identity</em> in its metadata MUST fail with <code>INTERNAL</code> status, its associated description indicating the invalid Compressed-Flag condition. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 18 2025 18:17:00 for GRPC C++ by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
